# Part 1. Настройка gitlab-runner

Поднять виртуальную машину Ubuntu Server 20.04 LTS

![linux](images/1.png)

Скачать и установить на виртуальную машину gitlab-runner

![linux](images/2.png)

Запустить gitlab-runner и зарегистрировать его для использования в текущем проекте (DO6_CICD)

![linux](images/3.png)

# Part 2. Сборка

Написать этап для CI по сборке приложений из проекта C2_SimpleBashUtils:

В файле gitlab-ci.yml добавить этап запуска сборки через мейк файл из проекта C2


Файлы, полученные после сборки (артефакты), сохранять в произвольную директорию со сроком хранения 30 дней.

Скрипт сборки:

![linux](images/5.png)

Этап сборки:

![linux](images/4.png)

Результат:

![linux](images/6.png)


# Part 3. Тест кодстайла

Написать этап для CI, который запускает скрипт кодстайла (clang-format):
Если кодстайл не прошел, то "зафейлить" пайплайн
В пайплайне отобразить вывод утилиты clang-format

Скрипт проверки:

![linux](images/7.png)

Этап проверки стиля:

![linux](images/8.png)

Успешный результат:

![linux](images/9.png)

Неуспешный результат:

![linux](images/10.png)

# Part 4. Интеграционные тесты

Написать этап для CI, который запускает ваши интеграционные тесты из того же проекта:
Запускать этот этап автоматически только при условии, если сборка и тест кодстайла прошли успешно
Если тесты не прошли, то "зафейлить" пайплайн
В пайплайне отобразить вывод, что интеграционные тесты успешно прошли / провалились

Скрипт тестов:

![linux](images/11.png)

Этап тестов:

![linux](images/12.png)

Успешный результат:

![linux](images/13.png)

Неуспешный результат:

![linux](images/14.png)

# Part 5. Этап деплоя

Поднять вторую виртуальную машину Ubuntu Server 20.04 LTS

![linux](images/15.png)

Написать этап для CD, который "разворачивает" проект на другой виртуальной машине:
Запускать этот этап вручную при условии, что все предыдущие этапы прошли успешно

![linux](images/16.png)

Написать bash-скрипт, который при помощи ssh и scp копирует файлы, полученные после сборки (артефакты), в директорию /usr/local/bin второй виртуальной машины

![linux](images/17.png)

Добавим вторую машину в одну сеть с первой машиной

![linux](images/18.png)

Создадим ssh ключ на машине с gitlab-runner командой ```ssh-keygen -t rsa``` и скопируем его на вторую машину командой ```ssh-copy-id danyellt@172.24.116.8```.

Поменяем привилегии на второй машине для директории /usr/local/bin для беспарольного копирования файлов командой ```sudo chown danyellt /usr/local/bin```

Успешный результат:

![linux](images/19.png)

Неуспешный результат:

![linux](images/20.png)

# Part 6. Дополнительно. Уведомления

Настроить уведомления о успешном/неуспешном выполнении пайплайна через бота с именем "[ваш nickname] DO6 CI/CD" в Telegram

Текст уведомления должен содержать информацию об успешности прохождения как этапа CI, так и этапа CD.
В остальном текст уведомления может быть произвольным.

Создание бота:

![linux](images/21.png)

Скрипт оповещения:

![linux](images/22.png)

Этапы:

![linux](images/23.png)

Результат:

![linux](images/24.png)